<!DOCTYPE html>
<html>
<head>
    <title>√Årbol Sint√°ctico - Compilador</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .node circle { fill: #6baed6; stroke: #3182bd; stroke-width: 1.5px; }
        .node text { font-size: 12px; font-weight: bold; }
        .link { fill: none; stroke: #ccc; stroke-width: 1.5px; }
        .node rect { fill: #4CAF50; stroke: #388E3C; stroke-width: 2px; rx: 5; ry: 5; }
        .node text { fill: white; font-weight: bold; }
        .node.leaf rect { fill: #2196F3; }
        .node.root rect { fill: #FF9800; }
        .controls { margin: 20px 0; }
        button { padding: 10px 15px; margin: 5px; background: #4CAF50; color: white; border: none; cursor: pointer; border-radius: 4px; }
        button:hover { background: #45a049; }
    </style>
</head>
<body>
    <h1>üå≥ √Årbol Sint√°ctico Generado</h1>
    <div class="controls">
        <button onclick="zoomIn()">+ Zoom In</button>
        <button onclick="zoomOut()">- Zoom Out</button>
        <button onclick="resetZoom()"> Reset</button>
        <button onclick="downloadSVG()">Descarga del grafico</button>
    </div>
    <div id="tree-container"></div>
    <script>
        const treeData = {"name":"PROGRAM", "value":"", "children": [{"name":"GLOBALES", "value":"", "children": [{"name":"DECL_GLOBAL", "value":"contador", "children": [{"name":"TIPO", "value":"int"}]}, {"name":"DECL_GLOBAL", "value":"matriz", "children": [{"name":"TIPO", "value":"char"}, {"name":"ARRAY_INIT", "value":"", "children": [{"name":"FILAS", "value":"", "children": [{"name":"FILA", "value":"", "children": [{"name":"ELEMENTOS", "value":"", "children": [{"name":"LITERAL_CHAR", "value":"a"}, {"name":"LITERAL_CHAR", "value":"b"}, {"name":"LITERAL_CHAR", "value":"c"}]}]}, {"name":"FILA", "value":"", "children": [{"name":"ELEMENTOS", "value":"", "children": [{"name":"LITERAL_CHAR", "value":"d"}, {"name":"LITERAL_CHAR", "value":"e"}, {"name":"LITERAL_CHAR", "value":"f"}]}]}]}]}]}]}, {"name":"FUNCIONES", "value":"", "children": [{"name":"FUNCION", "value":"suma", "children": [{"name":"TIPO", "value":"int"}, {"name":"PARAMETROS", "value":"", "children": [{"name":"PARAM", "value":"a", "children": [{"name":"TIPO", "value":"int"}]}, {"name":"PARAM", "value":"b", "children": [{"name":"TIPO", "value":"int"}]}]}, {"name":"BLOQUE", "value":"", "children": [{"name":"SENTENCIAS", "value":"", "children": [{"name":"DECL_LOCAL", "value":"resultado", "children": [{"name":"TIPO", "value":"int"}, {"name":"OPERACION", "value":"+", "children": [{"name":"IDENT", "value":"a"}, {"name":"IDENT", "value":"b"}]}]}, {"name":"RETURN", "value":"", "children": [{"name":"IDENT", "value":"resultado"}]}]}]}]}]}, {"name":"MAIN", "value":"navidad", "children": [{"name":"BLOQUE", "value":"", "children": [{"name":"SENTENCIAS", "value":"", "children": [{"name":"DECL_LOCAL", "value":"x", "children": [{"name":"TIPO", "value":"int"}, {"name":"LITERAL_INT", "value":"5"}]}, {"name":"DECL_LOCAL", "value":"y", "children": [{"name":"TIPO", "value":"int"}, {"name":"LITERAL_INT", "value":"10"}]}, {"name":"ASIGNACION", "value":"x", "children": [{"name":"LLAMADA", "value":"suma", "children": [{"name":"ARGUMENTOS", "value":"", "children": [{"name":"IDENT", "value":"x"}, {"name":"IDENT", "value":"y"}]}]}]}, {"name":"DECIDE", "value":"", "children": [{"name":"CASOS", "value":"", "children": [{"name":"CASO", "value":"", "children": [{"name":"OPERACION", "value":">", "children": [{"name":"IDENT", "value":"x"}, {"name":"LITERAL_INT", "value":"10"}]}, {"name":"BLOQUE", "value":"", "children": [{"name":"SENTENCIAS", "value":"", "children": [{"name":"ASIGNACION", "value":"x", "children": [{"name":"OPERACION", "value":"-", "children": [{"name":"IDENT", "value":"x"}, {"name":"LITERAL_INT", "value":"1"}]}]}]}]}]}, {"name":"CASO", "value":"", "children": [{"name":"OPERACION", "value":"==", "children": [{"name":"IDENT", "value":"x"}, {"name":"LITERAL_INT", "value":"10"}]}, {"name":"BLOQUE", "value":"", "children": [{"name":"SENTENCIAS", "value":"", "children": [{"name":"ASIGNACION", "value":"x", "children": [{"name":"OPERACION", "value":"+", "children": [{"name":"IDENT", "value":"x"}, {"name":"LITERAL_INT", "value":"1"}]}]}]}]}]}]}, {"name":"ELSE", "value":"", "children": [{"name":"BLOQUE", "value":"", "children": [{"name":"SENTENCIAS", "value":"", "children": [{"name":"ASIGNACION", "value":"x", "children": [{"name":"LITERAL_INT", "value":"0"}]}]}]}]}]}, {"name":"LOOP", "value":"", "children": [{"name":"SENTENCIAS", "value":"", "children": [{"name":"ASIGNACION", "value":"x", "children": [{"name":"OPERACION", "value":"-", "children": [{"name":"IDENT", "value":"x"}, {"name":"LITERAL_INT", "value":"1"}]}]}]}, {"name":"EXIT", "value":"", "children": [{"name":"OPERACION", "value":"==", "children": [{"name":"IDENT", "value":"x"}, {"name":"LITERAL_INT", "value":"0"}]}]}]}, {"name":"FOR", "value":"", "children": [{"name":"ASIGNACION", "value":"x", "children": [{"name":"LITERAL_INT", "value":"0"}]}, {"name":"OPERACION", "value":"<", "children": [{"name":"IDENT", "value":"x"}, {"name":"LITERAL_INT", "value":"3"}]}, {"name":"ASIGNACION", "value":"x", "children": [{"name":"OPERACION", "value":"+", "children": [{"name":"IDENT", "value":"x"}, {"name":"LITERAL_INT", "value":"1"}]}]}, {"name":"BLOQUE", "value":"", "children": [{"name":"SENTENCIAS", "value":"", "children": [{"name":"ASIGNACION_ARRAY", "value":"", "children": [{"name":"ARRAY_ACCESS", "value":"matriz", "children": [{"name":"IDENT", "value":"x"}, {"name":"LITERAL_INT", "value":"0"}]}, {"name":"LITERAL_CHAR", "value":"z"}]}]}]}]}, {"name":"RETURN", "value":"", "children": [{"name":"IDENT", "value":"x"}]}]}]}]}]};

        const margin = { top: 40, right: 120, bottom: 40, left: 120 };
        const width = 1600 - margin.left - margin.right;
        const height = 800 - margin.top - margin.bottom;

        const svg = d3.select('#tree-container')
            .append('svg')
            .attr('width', width + margin.left + margin.right)
            .attr('height', height + margin.top + margin.bottom)
            .append('g')
            .attr('transform', `translate(${margin.left},${margin.top})`);

        let zoom = d3.zoom()
            .scaleExtent([0.1, 3])
            .on('zoom', (event) => {
                svg.attr('transform', event.transform);
            });

        d3.select('svg').call(zoom);

        const root = d3.hierarchy(treeData);
        const treeLayout = d3.tree().size([height, width - 200]);
        treeLayout(root);

        // Enlaces
        svg.selectAll('.link')
            .data(root.links())
            .enter()
            .append('path')
            .attr('class', 'link')
            .attr('d', d3.linkHorizontal()
                .x(d => d.y)
                .y(d => d.x));

        // Nodos
        const node = svg.selectAll('.node')
            .data(root.descendants())
            .enter()
            .append('g')
            .attr('class', d => 'node ' + (d.children ? 'internal' : 'leaf') + (d.depth === 0 ? ' root' : ''))
            .attr('transform', d => `translate(${d.y},${d.x})`);

        // Rect√°ngulos para nodos
        node.append('rect')
            .attr('width', d => Math.max(100, d.data.name.length * 8))
            .attr('height', 40)
            .attr('x', -50)
            .attr('y', -20);

        // Texto de nodos
        node.append('text')
            .attr('dy', '.35em')
            .attr('text-anchor', 'middle')
            .text(d => {
                let text = d.data.name;
                if (d.data.value && d.data.value !== 'null') {
                    text += '\n' + d.data.value;
                }
                return text;
            })
            .attr('font-size', '11px')
            .attr('fill', 'white');

        // Funciones de control
        function zoomIn() {
            d3.select('svg').transition().duration(300).call(zoom.scaleBy, 1.3);
        }
        function zoomOut() {
            d3.select('svg').transition().duration(300).call(zoom.scaleBy, 0.7);
        }
        function resetZoom() {
            d3.select('svg').transition().duration(300).call(zoom.transform, d3.zoomIdentity);
        }
        function downloadSVG() {
            const svgData = new XMLSerializer().serializeToString(document.querySelector('svg'));
            const blob = new Blob([svgData], {type: 'image/svg+xml'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'arbol_sintactico.svg';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
